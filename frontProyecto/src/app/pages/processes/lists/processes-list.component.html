<section class="page">
  <header class="page-header">
    <div class="titles">
      <h1>Procesos</h1>
      <p class="subtitle">Administra y filtra los procesos de tu empresa</p>
    </div>
    <a class="btn btn-primary" routerLink="/processes/new">
      <span class="icon">ï¼‹</span> Nuevo
    </a>
  </header>

  <form (ngSubmit)="fetch()" class="filters" aria-label="Filtros de procesos">
    <div class="field">
      <label for="q">Buscar</label>
      <input id="q" [(ngModel)]="q" name="q" placeholder="Nombre, palabra clave..." />
    </div>

    <div class="field">
      <label for="status">Estado</label>
      <select id="status" [(ngModel)]="status" name="status">
        <option value="">Todos</option>
        <option value="DRAFT">Borrador</option>
        <option value="ACTIVE">Activo</option>
        <option value="ARCHIVED">Archivado</option>
      </select>
    </div>

    <div class="actions-inline">
      <button type="submit" class="btn">Filtrar</button>
      <button type="button" class="btn btn-ghost"
              (click)="q=''; status=''; fetch()">
        Limpiar
      </button>
    </div>
  </form>

  <div class="card" *ngIf="loading()">
    <div class="table">
      <div class="table-row skeleton"></div>
      <div class="table-row skeleton"></div>
      <div class="table-row skeleton"></div>
    </div>
    <div class="loading">
      <span class="spinner" aria-hidden="true"></span>
      Cargando...
    </div>
  </div>

  <div class="card empty" *ngIf="!loading() && (rows()?.length === 0)">
    <div class="empty-inner">
      <div class="empty-illustration" aria-hidden="true">ðŸ“„</div>
      <h3>No hay procesos</h3>
      <p>Prueba ajustando los filtros o crea un nuevo proceso.</p>
      <a class="btn btn-primary" routerLink="/processes/new">Crear proceso</a>
    </div>
  </div>

  <div class="card table-wrapper" *ngIf="!loading() && (rows()?.length ?? 0) > 0">
    <table class="table" aria-label="Listado de procesos">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Estado</th>
          <th>Actualizado</th>
          <th class="col-actions">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of rows()">
          <td class="name-cell">
            <a class="name-link" [routerLink]="['/processes', p.id]">{{ p.name }}</a>
          </td>
          <td>
            <span class="badge"
                  [ngClass]="{
                    'is-draft': p.status==='DRAFT',
                    'is-active': p.status==='ACTIVE',
                    'is-archived': p.status==='ARCHIVED'
                  }">
              {{ p.status }}
            </span>
          </td>
          <td>{{ p.updatedAt | date:'short' }}</td>
          <td class="actions">
            <a class="btn btn-ghost" [routerLink]="['/processes', p.id]">Ver</a>
            <a class="btn btn-ghost" [routerLink]="['/processes', p.id, 'edit']">Editar</a>
            <button class="btn btn-danger" (click)="onDelete(p)">Eliminar</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>
